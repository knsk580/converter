# HTML→JSON変換ツール 実行手順書

## 概要

業務システムのマニュアルやFAQのHTMLファイルを、OpenAI APIのfile_search機能で使用するJSON形式に変換するツールです。

## ファイル構成

```
converter/
├── html_to_json_converter.py    # メインの変換スクリプト
├── converter_demo.ipynb         # Google Colab用のデモnotebook
├── test_converter.py            # シンプルなテスト用スクリプト
├── noise_pattern.txt            # ノイズ除去パターン設定
├── input/                       # HTMLファイル配置フォルダ
│   ├── sample_manual.html       # サンプルマニュアル
│   └── sample_faq.html          # サンプルFAQ
├── output/                      # 変換結果出力フォルダ
│   └── sample_converted_documents.json  # サンプル出力
├── README.md                    # 詳細な説明書
└── 実行手順書.md               # この手順書
```

## 実行方法

### 方法1: Google Colab（推奨）

Google Colabでの実行が最も簡単で確実です。

1. **Colabでnotebookを開く**
   ```
   converter_demo.ipynb をGoogle Colabで開く
   ```

2. **環境準備**
   - 最初のセルを実行してディレクトリを作成

3. **HTMLファイルのアップロード**
   - 2番目のセルを実行してファイルをアップロード
   - 変換したいHTMLファイルを選択

4. **変換実行**
   - 変換スクリプトのセルを実行

5. **結果のダウンロード**
   - 最後のセルを実行してJSONファイルをダウンロード

### 方法2: PowerShell（Windows）

1. **必要なライブラリのインストール**
   ```powershell
   pip install beautifulsoup4 lxml requests langchain langchain-text-splitters pypandoc
   ```

2. **Pandocのインストール**
   - https://pandoc.org/installing.html からダウンロードしてインストール

3. **HTMLファイルの配置**
   ```powershell
   # HTMLファイルをinputフォルダにコピー
   Copy-Item "C:\path\to\your\file.html" -Destination "input\"
   ```

4. **変換実行**
   ```powershell
   python html_to_json_converter.py
   ```

5. **結果確認**
   ```powershell
   Get-Content "output\converted_documents.json" | ConvertFrom-Json | Select-Object -First 1
   ```

### 方法3: シンプル版（依存関係なし）

外部ライブラリなしで基本的な変換を行う場合：

```powershell
python test_converter.py
```

## 設定のカスタマイズ

### ノイズパターンの追加

`noise_pattern.txt` を編集して、除去したいHTMLパターンを追加：

```
# コメント行は#で始める
<div class="advertisement">.*?</div>
<aside[^>]*>.*?</aside>
<div class="sidebar">.*?</div>
```

### 出力形式の調整

`html_to_json_converter.py` の `markdown_to_json` メソッドで、メタデータの項目を調整できます。

## 出力形式

変換されたJSONファイルの構造：

```json
[
  {
    "id": "filename_section_number",
    "content": "Markdownで変換されたコンテンツ",
    "metadata": {
      "source": "元のHTMLファイル名",
      "url": "抽出されたページURL",
      "section_id": 0,
      "Header 1": "大見出し",
      "Header 2": "中見出し",
      "Header 3": "小見出し"
    }
  }
]
```

## トラブルシューティング

### よくある問題と解決方法

1. **Pythonが見つからない**
   ```powershell
   # Pythonのパスを確認
   Get-Command python -ErrorAction SilentlyContinue
   
   # Microsoft Store版を使用
   python.exe html_to_json_converter.py
   ```

2. **ライブラリのインストールエラー**
   ```powershell
   # pipを最新版に更新
   python -m pip install --upgrade pip
   
   # 個別にインストール
   pip install beautifulsoup4
   pip install langchain
   ```

3. **文字化け**
   ```powershell
   # PowerShellの文字エンコーディングを設定
   $OutputEncoding = [System.Text.Encoding]::UTF8
   ```

4. **Pandocがない場合**
   - スクリプトはフォールバック機能で動作します
   - より良い変換のためPandocのインストールを推奨

### エラーログの確認

スクリプト実行時のログを確認して問題を特定：

```powershell
python html_to_json_converter.py > conversion.log 2>&1
Get-Content conversion.log
```

## サンプルデータの確認

プロジェクトにはサンプルファイルが含まれています：

- `input/sample_manual.html` - 業務システムマニュアルのサンプル
- `input/sample_faq.html` - FAQ のサンプル
- `output/sample_converted_documents.json` - 期待される出力形式

## 次のステップ

変換されたJSONファイルは以下の用途で使用できます：

1. **OpenAI file_search**
   ```python
   # vector storeにアップロード
   client.beta.vector_stores.file_batches.upload_and_poll(
       vector_store_id="vs_123",
       files=[open("output/converted_documents.json", "rb")]
   )
   ```

2. **カスタムRAGシステム**
   - 各ドキュメントをembeddingして検索データベースに格納
   - メタデータを活用してフィルタリング

3. **品質チェック**
   - 変換結果の内容を確認
   - 必要に応じてノイズパターンを調整

## サポート

問題や質問がある場合は、以下を確認してください：

1. README.md の詳細な説明
2. converter_demo.ipynb のサンプル実行
3. GitHubのIssueトラッカー（該当する場合）
